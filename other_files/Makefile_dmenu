OUT := $(PWD)/dmenu_out
DMENU_VERSION := dmenu-4.5
DMENU_ARCHIVE_NAME := $(DMENU_VERSION).tar.gz
DMENU_URL := dl.suckless.org/tools/$(DMENU_ARCHIVE_NAME)
PATCH_NAME := dmenu-4.5-xft-debian.diff
PATCH_URL := tools.suckless.org/dmenu/patches/$(PATCH_NAME)

PHONY := all
all: apply_patch
	make -C $(OUT)/$(DMENU_VERSION)
	su -c "make -C $(OUT)/$(DMENU_VERSION) install"

PHONY += apply_patch
apply_patch: $(OUT)/$(DMENU_VERSION) $(OUT)/$(PATCH_NAME)
	patch -N -d $< -p 1 < $(OUT)/$(PATCH_NAME) || true

$(OUT)/$(PATCH_NAME): | $(OUT)
	wget -P $| $(PATCH_URL)

$(OUT)/$(DMENU_VERSION): $(OUT)/$(DMENU_ARCHIVE_NAME)
	tar xf $< -C $(OUT)

$(OUT)/$(DMENU_ARCHIVE_NAME): | $(OUT)
	wget -P $| $(DMENU_URL)

PHONY += clean
clean:
	rm -rf $(OUT)

$(OUT):
	mkdir -p $@

.PHONY: $(PHONY)
